Water-Runner-Simulation-V2/Water/Linearized
=======================================

Models
------

There are three models in this folder:

1. WaterRunner\_closed.slx - This model includes the full water runner model with the inverse dynamics controller [presented at the Dynamic Walking 2013 conference][1]. The inverse dynamics controller uses a system model linearized about the desired position and controls the height and roll of the robot. The pitch is passively controled via the tail of the robot.


2. WaterRunner\_open.slx - This model includes the full water runner model with no controller on height or roll.

3. WaterRunner\_nocpg.mdl - This model includes the full water runner model with no controller on height or roll or CPG maintaining phase differences. All legs driven at specified frequency.

simParam.m
----------

This file contains setup parameters and options and should be run before the simulation is started. There are several sections of parameters in this file:

1. Initial and desired conditions and disturbance inputs.
2. Robot Parameters
	1. leg link lengths and frame size
	2. Robot mass is calculated from geometry and density of legs and assumed mass of the body.
3. Water Model Parameters
	1. foot area
	2. foot area folding ratio
	3. drag coefficient
	4. gravity
4. Controller Parameters
	1. Calculates requrired steady state frequncy from desired height. Input dynamics are linearized about this frequncy. 
	2. Computes Taylor series terms to produce linear model for controller. Also, at the end of this section is
	  the coupling gain "Cgain" for the nullspacep projection calculation in the inverse dynamics controller.
	3. PID gains tuned via Ziegler Nichols Method
	4. CPG parameters including phase lags between legs and cpg gain

genForceFunctions.m
-------------------

Uses the symbolic equation for the average force generated by a foot to generate m file functions for the average force and its derivatives with respect to height, y; roll, theta; and control inputs, w1 and w2. The force function and its first derivatives are used to linearize the system. 

findParams.m
------------

Fits two parameters in the averaged vertical water model to steady state data from an open loop run of the robot. The two parameters that are fit are:
1. The area of the foot compared to the actual area
2. The amplitude of the foot in meters

findSSinput.m
--------------

Solve force function for steady state leg frequency for a given desired height. Steady state input will create an average force equal to the weight. This function is used by simParam.m to find the steady state input that will achieve the desired height.

findSSheight.m
--------------
Solve force function for steady state height for a given w1 and w2. Steady state height will create an average force equal to the weight.

search\*.m
----------

The m files with the search moniker run the model while sweeping various parameters and then plots the results.

[1]: ../../../Documents/DynamicWalking/poster.pdf             "Dynamic Walking 2013 poster"
